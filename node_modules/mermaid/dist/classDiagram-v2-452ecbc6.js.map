{"version":3,"file":"classDiagram-v2-452ecbc6.js","sources":["../src/diagrams/class/classRenderer-v2.js","../src/diagrams/class/classDiagram-v2.ts"],"sourcesContent":["import { select } from 'd3';\nimport * as graphlib from 'dagre-d3-es/src/graphlib/index.js';\nimport { log } from '../../logger';\nimport { getConfig } from '../../config';\nimport { render } from '../../dagre-wrapper/index.js';\nimport utils from '../../utils';\nimport { curveLinear } from 'd3';\nimport { interpolateToCurve, getStylesFromArray } from '../../utils';\nimport { setupGraphViewbox } from '../../setupGraphViewbox';\nimport common from '../common/common';\n\nconst sanitizeText = (txt) => common.sanitizeText(txt, getConfig());\n\nlet conf = {\n  dividerMargin: 10,\n  padding: 5,\n  textHeight: 10,\n};\n\n/**\n * Function that adds the vertices found during parsing to the graph to be rendered.\n *\n * @param {Object<\n *   string,\n *   { cssClasses: string[]; text: string; id: string; type: string; domId: string }\n * >} classes\n *   Object containing the vertices.\n * @param {SVGGElement} g The graph that is to be drawn.\n * @param _id\n * @param diagObj\n */\nexport const addClasses = function (classes, g, _id, diagObj) {\n  // const svg = select(`[id=\"${svgId}\"]`);\n  const keys = Object.keys(classes);\n  log.info('keys:', keys);\n  log.info(classes);\n\n  // Iterate through each item in the vertex object (containing all the vertices found) in the graph definition\n  keys.forEach(function (id) {\n    const vertex = classes[id];\n\n    /**\n     * Variable for storing the classes for the vertex\n     *\n     * @type {string}\n     */\n    let cssClassStr = '';\n    if (vertex.cssClasses.length > 0) {\n      cssClassStr = cssClassStr + ' ' + vertex.cssClasses.join(' ');\n    }\n    // if (vertex.classes.length > 0) {\n    //   classStr = vertex.classes.join(' ');\n    // }\n\n    const styles = { labelStyle: '' }; //getStylesFromArray(vertex.styles);\n\n    // Use vertex id as text in the box if no text is provided by the graph definition\n    let vertexText = vertex.text !== undefined ? vertex.text : vertex.id;\n\n    // We create a SVG label, either by delegating to addHtmlLabel or manually\n    // let vertexNode;\n    // if (evaluate(getConfig().flowchart.htmlLabels)) {\n    //   const node = {\n    //     label: vertexText.replace(\n    // eslint-disable-next-line @cspell/spellchecker\n    //       /fa[lrsb]?:fa-[\\w-]+/g,\n    //       s => `<i class='${s.replace(':', ' ')}'></i>`\n    //     )\n    //   };\n    //   vertexNode = addHtmlLabel(svg, node).node();\n    //   vertexNode.parentNode.removeChild(vertexNode);\n    // } else {\n    //   const svgLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');\n    //   svgLabel.setAttribute('style', styles.labelStyle.replace('color:', 'fill:'));\n\n    //   const rows = vertexText.split(common.lineBreakRegex);\n\n    //   for (let j = 0; j < rows.length; j++) {\n    //     const tspan = document.createElementNS('http://www.w3.org/2000/svg', 'tspan');\n    //     tspan.setAttributeNS('http://www.w3.org/XML/1998/namespace', 'xml:space', 'preserve');\n    //     tspan.setAttribute('dy', '1em');\n    //     tspan.setAttribute('x', '1');\n    //     tspan.textContent = rows[j];\n    //     svgLabel.appendChild(tspan);\n    //   }\n    //   vertexNode = svgLabel;\n    // }\n\n    let radious = 0;\n    let _shape = '';\n    // Set the shape based parameters\n    switch (vertex.type) {\n      case 'class':\n        _shape = 'class_box';\n        break;\n      default:\n        _shape = 'class_box';\n    }\n    // Add the node\n    g.setNode(vertex.id, {\n      labelStyle: styles.labelStyle,\n      shape: _shape,\n      labelText: sanitizeText(vertexText),\n      classData: vertex,\n      rx: radious,\n      ry: radious,\n      class: cssClassStr,\n      style: styles.style,\n      id: vertex.id,\n      domId: vertex.domId,\n      tooltip: diagObj.db.getTooltip(vertex.id) || '',\n      haveCallback: vertex.haveCallback,\n      link: vertex.link,\n      width: vertex.type === 'group' ? 500 : undefined,\n      type: vertex.type,\n      padding: getConfig().flowchart.padding,\n    });\n\n    log.info('setNode', {\n      labelStyle: styles.labelStyle,\n      shape: _shape,\n      labelText: vertexText,\n      rx: radious,\n      ry: radious,\n      class: cssClassStr,\n      style: styles.style,\n      id: vertex.id,\n      width: vertex.type === 'group' ? 500 : undefined,\n      type: vertex.type,\n      padding: getConfig().flowchart.padding,\n    });\n  });\n};\n\n/**\n * Function that adds the additional vertices (notes) found during parsing to the graph to be rendered.\n *\n * @param {{text: string; class: string; placement: number}[]} notes\n *   Object containing the additional vertices (notes).\n * @param {SVGGElement} g The graph that is to be drawn.\n * @param {number} startEdgeId starting index for note edge\n * @param classes\n */\nexport const addNotes = function (notes, g, startEdgeId, classes) {\n  log.info(notes);\n\n  // Iterate through each item in the vertex object (containing all the vertices found) in the graph definition\n  notes.forEach(function (note, i) {\n    const vertex = note;\n\n    /**\n     * Variable for storing the classes for the vertex\n     *\n     * @type {string}\n     */\n    let cssNoteStr = '';\n\n    const styles = { labelStyle: '', style: '' };\n\n    // Use vertex id as text in the box if no text is provided by the graph definition\n    let vertexText = vertex.text;\n\n    let radious = 0;\n    let _shape = 'note';\n    // Add the node\n    g.setNode(vertex.id, {\n      labelStyle: styles.labelStyle,\n      shape: _shape,\n      labelText: sanitizeText(vertexText),\n      noteData: vertex,\n      rx: radious,\n      ry: radious,\n      class: cssNoteStr,\n      style: styles.style,\n      id: vertex.id,\n      domId: vertex.id,\n      tooltip: '',\n      type: 'note',\n      padding: getConfig().flowchart.padding,\n    });\n\n    log.info('setNode', {\n      labelStyle: styles.labelStyle,\n      shape: _shape,\n      labelText: vertexText,\n      rx: radious,\n      ry: radious,\n      style: styles.style,\n      id: vertex.id,\n      type: 'note',\n      padding: getConfig().flowchart.padding,\n    });\n\n    if (!vertex.class || !(vertex.class in classes)) {\n      return;\n    }\n    const edgeId = startEdgeId + i;\n    const edgeData = {};\n    //Set relationship style and line type\n    edgeData.classes = 'relation';\n    edgeData.pattern = 'dotted';\n\n    edgeData.id = `edgeNote${edgeId}`;\n    // Set link type for rendering\n    edgeData.arrowhead = 'none';\n\n    log.info(`Note edge: ${JSON.stringify(edgeData)}, ${JSON.stringify(vertex)}`);\n    //Set edge extra labels\n    edgeData.startLabelRight = '';\n    edgeData.endLabelLeft = '';\n\n    //Set relation arrow types\n    edgeData.arrowTypeStart = 'none';\n    edgeData.arrowTypeEnd = 'none';\n    let style = 'fill:none';\n    let labelStyle = '';\n\n    edgeData.style = style;\n    edgeData.labelStyle = labelStyle;\n\n    edgeData.curve = interpolateToCurve(conf.curve, curveLinear);\n\n    // Add the edge to the graph\n    g.setEdge(vertex.id, vertex.class, edgeData, edgeId);\n  });\n};\n\n/**\n * Add edges to graph based on parsed graph definition\n *\n * @param relations\n * @param {object} g The graph object\n */\nexport const addRelations = function (relations, g) {\n  const conf = getConfig().flowchart;\n  let cnt = 0;\n\n  let defaultStyle;\n  let defaultLabelStyle;\n\n  // if (typeof relations.defaultStyle !== 'undefined') {\n  //   const defaultStyles = getStylesFromArray(relations.defaultStyle);\n  //   defaultStyle = defaultStyles.style;\n  //   defaultLabelStyle = defaultStyles.labelStyle;\n  // }\n\n  relations.forEach(function (edge) {\n    cnt++;\n    const edgeData = {};\n    //Set relationship style and line type\n    edgeData.classes = 'relation';\n    edgeData.pattern = edge.relation.lineType == 1 ? 'dashed' : 'solid';\n\n    edgeData.id = 'id' + cnt;\n    // Set link type for rendering\n    if (edge.type === 'arrow_open') {\n      edgeData.arrowhead = 'none';\n    } else {\n      edgeData.arrowhead = 'normal';\n    }\n\n    log.info(edgeData, edge);\n    //Set edge extra labels\n    //edgeData.startLabelLeft = edge.relationTitle1;\n    edgeData.startLabelRight = edge.relationTitle1 === 'none' ? '' : edge.relationTitle1;\n    edgeData.endLabelLeft = edge.relationTitle2 === 'none' ? '' : edge.relationTitle2;\n    //edgeData.endLabelRight = edge.relationTitle2;\n\n    //Set relation arrow types\n    edgeData.arrowTypeStart = getArrowMarker(edge.relation.type1);\n    edgeData.arrowTypeEnd = getArrowMarker(edge.relation.type2);\n    let style = '';\n    let labelStyle = '';\n\n    if (edge.style !== undefined) {\n      const styles = getStylesFromArray(edge.style);\n      style = styles.style;\n      labelStyle = styles.labelStyle;\n    } else {\n      style = 'fill:none';\n      if (defaultStyle !== undefined) {\n        style = defaultStyle;\n      }\n      if (defaultLabelStyle !== undefined) {\n        labelStyle = defaultLabelStyle;\n      }\n    }\n\n    edgeData.style = style;\n    edgeData.labelStyle = labelStyle;\n\n    if (edge.interpolate !== undefined) {\n      edgeData.curve = interpolateToCurve(edge.interpolate, curveLinear);\n    } else if (relations.defaultInterpolate !== undefined) {\n      edgeData.curve = interpolateToCurve(relations.defaultInterpolate, curveLinear);\n    } else {\n      edgeData.curve = interpolateToCurve(conf.curve, curveLinear);\n    }\n\n    edge.text = edge.title;\n    if (edge.text === undefined) {\n      if (edge.style !== undefined) {\n        edgeData.arrowheadStyle = 'fill: #333';\n      }\n    } else {\n      edgeData.arrowheadStyle = 'fill: #333';\n      edgeData.labelpos = 'c';\n\n      if (getConfig().flowchart.htmlLabels) {\n        edgeData.labelType = 'html';\n        edgeData.label = '<span class=\"edgeLabel\">' + edge.text + '</span>';\n      } else {\n        edgeData.labelType = 'text';\n        edgeData.label = edge.text.replace(common.lineBreakRegex, '\\n');\n\n        if (edge.style === undefined) {\n          edgeData.style = edgeData.style || 'stroke: #333; stroke-width: 1.5px;fill:none';\n        }\n\n        edgeData.labelStyle = edgeData.labelStyle.replace('color:', 'fill:');\n      }\n    }\n    // Add the edge to the graph\n    g.setEdge(edge.id1, edge.id2, edgeData, cnt);\n  });\n};\n\n/**\n * Merges the value of `conf` with the passed `cnf`\n *\n * @param {object} cnf Config to merge\n */\nexport const setConf = function (cnf) {\n  const keys = Object.keys(cnf);\n\n  keys.forEach(function (key) {\n    conf[key] = cnf[key];\n  });\n};\n\n/**\n * Draws a flowchart in the tag with id: id based on the graph definition in text.\n *\n * @param {string} text\n * @param {string} id\n * @param _version\n * @param diagObj\n */\nexport const draw = function (text, id, _version, diagObj) {\n  log.info('Drawing class - ', id);\n\n  const conf = getConfig().flowchart;\n  const securityLevel = getConfig().securityLevel;\n  log.info('config:', conf);\n  const nodeSpacing = conf.nodeSpacing || 50;\n  const rankSpacing = conf.rankSpacing || 50;\n\n  // Create the input mermaid.graph\n  const g = new graphlib.Graph({\n    multigraph: true,\n    compound: true,\n  })\n    .setGraph({\n      rankdir: diagObj.db.getDirection(),\n      nodesep: nodeSpacing,\n      ranksep: rankSpacing,\n      marginx: 8,\n      marginy: 8,\n    })\n    .setDefaultEdgeLabel(function () {\n      return {};\n    });\n\n  // Fetch the vertices/nodes and edges/links from the parsed graph definition\n  const classes = diagObj.db.getClasses();\n  const relations = diagObj.db.getRelations();\n  const notes = diagObj.db.getNotes();\n\n  log.info(relations);\n  addClasses(classes, g, id, diagObj);\n  addRelations(relations, g);\n  addNotes(notes, g, relations.length + 1, classes);\n\n  // Add custom shapes\n  // flowChartShapes.addToRenderV2(addShape);\n\n  // Set up an SVG group so that we can translate the final graph.\n  let sandboxElement;\n  if (securityLevel === 'sandbox') {\n    sandboxElement = select('#i' + id);\n  }\n  const root =\n    securityLevel === 'sandbox'\n      ? select(sandboxElement.nodes()[0].contentDocument.body)\n      : select('body');\n  const svg = root.select(`[id=\"${id}\"]`);\n\n  // Run the renderer. This is what draws the final graph.\n  const element = root.select('#' + id + ' g');\n  render(\n    element,\n    g,\n    ['aggregation', 'extension', 'composition', 'dependency', 'lollipop'],\n    'classDiagram',\n    id\n  );\n\n  utils.insertTitle(svg, 'classTitleText', conf.titleTopMargin, diagObj.db.getDiagramTitle());\n\n  setupGraphViewbox(g, svg, conf.diagramPadding, conf.useMaxWidth);\n\n  // Add label rects for non html labels\n  if (!conf.htmlLabels) {\n    const doc = securityLevel === 'sandbox' ? sandboxElement.nodes()[0].contentDocument : document;\n    const labels = doc.querySelectorAll('[id=\"' + id + '\"] .edgeLabel .label');\n    for (const label of labels) {\n      // Get dimensions of label\n      const dim = label.getBBox();\n\n      const rect = doc.createElementNS('http://www.w3.org/2000/svg', 'rect');\n      rect.setAttribute('rx', 0);\n      rect.setAttribute('ry', 0);\n      rect.setAttribute('width', dim.width);\n      rect.setAttribute('height', dim.height);\n      // rect.setAttribute('style', 'fill:#e8e8e8;');\n\n      label.insertBefore(rect, label.firstChild);\n    }\n  }\n\n  // If node has a link, wrap it in an anchor SVG object.\n  // const keys = Object.keys(classes);\n  // keys.forEach(function(key) {\n  //   const vertex = classes[key];\n\n  //   if (vertex.link) {\n  //     const node = select('#' + id + ' [id=\"' + key + '\"]');\n  //     if (node) {\n  //       const link = document.createElementNS('http://www.w3.org/2000/svg', 'a');\n  //       link.setAttributeNS('http://www.w3.org/2000/svg', 'class', vertex.classes.join(' '));\n  //       link.setAttributeNS('http://www.w3.org/2000/svg', 'href', vertex.link);\n  //       link.setAttributeNS('http://www.w3.org/2000/svg', 'rel', 'noopener');\n\n  //       const linkNode = node.insert(function() {\n  //         return link;\n  //       }, ':first-child');\n\n  //       const shape = node.select('.label-container');\n  //       if (shape) {\n  //         linkNode.append(function() {\n  //           return shape.node();\n  //         });\n  //       }\n\n  //       const label = node.select('.label');\n  //       if (label) {\n  //         linkNode.append(function() {\n  //           return label.node();\n  //         });\n  //       }\n  //     }\n  //   }\n  // });\n};\n\n/**\n * Gets the arrow marker for a type index\n *\n * @param {number} type The type to look for\n * @returns {'aggregation' | 'extension' | 'composition' | 'dependency'} The arrow marker\n */\nfunction getArrowMarker(type) {\n  let marker;\n  switch (type) {\n    case 0:\n      marker = 'aggregation';\n      break;\n    case 1:\n      marker = 'extension';\n      break;\n    case 2:\n      marker = 'composition';\n      break;\n    case 3:\n      marker = 'dependency';\n      break;\n    case 4:\n      marker = 'lollipop';\n      break;\n    default:\n      marker = 'none';\n  }\n  return marker;\n}\n\nexport default {\n  setConf,\n  draw,\n};\n","import { DiagramDefinition } from '../../diagram-api/types';\n// @ts-ignore: TODO Fix ts errors\nimport parser from './parser/classDiagram';\nimport db from './classDb';\nimport styles from './styles';\nimport renderer from './classRenderer-v2';\n\nexport const diagram: DiagramDefinition = {\n  parser,\n  db,\n  renderer,\n  styles,\n  init: (cnf) => {\n    if (!cnf.class) {\n      cnf.class = {};\n    }\n    cnf.class.arrowMarkerAbsolute = cnf.arrowMarkerAbsolute;\n    db.clear();\n  },\n};\n"],"names":["sanitizeText","txt","common","getConfig","conf","addClasses","classes","g","_id","diagObj","keys","log","id","vertex","cssClassStr","styles","vertexText","radious","_shape","addNotes","notes","startEdgeId","note","i","cssNoteStr","edgeId","edgeData","style","labelStyle","interpolateToCurve","curveLinear","addRelations","relations","cnt","edge","getArrowMarker","getStylesFromArray","setConf","cnf","key","draw","text","_version","securityLevel","nodeSpacing","rankSpacing","graphlib.Graph","sandboxElement","select","root","svg","element","render","utils","setupGraphViewbox","doc","labels","label","dim","rect","type","marker","renderer","diagram","parser","db"],"mappings":"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"}